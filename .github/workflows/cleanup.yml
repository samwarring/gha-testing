# This is an example of a job that runs when a branch or tag  is deleted.
# One can use a workflow like this to clean up any environments or
# intermediate artifacts maintained for each branch/tag.
#
# If lots of tags are deleted at once, then this workflow may not run.
# For this reason, the workflow can also be triggered manually via the
# 'workflow_dispatch' trigger.
#
# Also note if the workflow is triggered by 'delete', then the deleted
# branch cannot be accessed, and the version of the workflow in the default
# branch will be executed.

name: Cleanup
on:
  delete:
  workflow_dispatch:
    inputs:
      branch_name:
        description: Name of the branch to clean up
        type: string
        required: true
      force:
        description: Allow cleanup of 'main' and 'release/**' branches
        type: boolean
        required: false
        default: false        
jobs:
  cleanup:
    name: Cleanup
    runs-on: ubuntu-latest
    # Branch name is accessed differently depending on the workflow trigger.
    # (inputs.branch_name if 'workflow_dispatch', or github.event.ref if
    # 'delete'). Prevent cleaning up the main or release branches unless
    # the 'force' parameter is enabled.
    if: |
      inputs.force ||
      ((inputs.branch_name || github.event.ref) != 'main') &&
      (!contains((inputs.branch_name || github.event.ref), 'release'))
    steps:
      - name: Print branch name
        run: echo Cleaning up branch ${{ inputs.branch_name || github.event.ref }}
      - name: Write summary
        run: echo "# Cleaned up '${{ inputs.branch_name || github.event.ref }}' >$GITHUB_STEP_SUMMARY
